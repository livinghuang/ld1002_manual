---
icon: hand-point-right
hidden: true
---

# Linxdot å®‰è£ Chirpstack Gateway Mesh ä¸¦è¨­å®šè§’è‰²ç‚º Relayï¼ˆä¸­ç¹¼é–˜é“å™¨ï¼‰

#### **æœ¬ç« å°‡å¼•å°æ‚¨åœ¨ Linxdot Hotspot** å®‰è£èˆ‡è¨­å®šç‚º Chirpstack Gateway Mesh Relay

#### **ChirpStack Gateway Mesh ç°¡ä»‹**

**ChirpStack Gateway Mesh** æ˜¯ä¸€æ¬¾ **è»Ÿé«”çµ„ä»¶**ï¼Œå¯ä»¥é‹è¡Œåœ¨ **LoRaÂ® é–˜é“å™¨** ä¸Šï¼Œå°‡é€™äº›é–˜é“å™¨è½‰æ›ç‚º **å…©ç¨®è§’è‰²**ï¼š

1. **Relay Gatewayï¼ˆä¸­ç¹¼é–˜é“å™¨ï¼‰**ï¼š
   * ä¸»è¦è² è²¬ **è½‰ç™¼ LoRaWAN è³‡æ–™**ï¼ˆä¸Šè¡Œèˆ‡ä¸‹è¡Œï¼‰ã€‚
   * é©ç”¨æ–¼ç„¡æ³•ç›´æ¥é€£æ¥ç¶²éš›ç¶²è·¯çš„é–˜é“å™¨ï¼Œé€šå¸¸ç‚º **å¤ªé™½èƒ½ä¾›é›»** çš„é ç«¯è¨­å‚™ã€‚
2. **Border Gatewayï¼ˆé‚Šç•Œé–˜é“å™¨ï¼‰**ï¼š
   * è² è²¬ **çµ‚æ­¢ Mesh å”è­°**ï¼Œä¸¦èˆ‡ **ChirpStack ä¼ºæœå™¨** ç›´æ¥é€šè¨Šã€‚
   * éœ€è¦ **ç¶²éš›ç¶²è·¯é€£æ¥**ï¼Œä»¥è™•ç†ä¾†è‡ª Relay Gateway çš„ LoRaWAN è¨Šæ¯ã€‚

<figure><img src="../.gitbook/assets/æˆªåœ– 2025-02-15 æ¸…æ™¨7.29.51.png" alt=""><figcaption><p><strong>ChirpStack Gateway Mesh æ¶æ§‹åœ–</strong></p></figcaption></figure>

***

#### **ChirpStack Gateway Mesh çš„ç›®çš„**

è©²çµ„ä»¶çš„ä¸»è¦ç›®æ¨™æ˜¯ **æ“´å±• LoRaWANÂ® è¦†è“‹ç¯„åœ**ï¼Œå°¤å…¶é©ç”¨æ–¼ **é ç«¯åœ°å€** æˆ– **ç¶²éš›ç¶²è·¯è¦†è“‹ä¸è¶³** çš„ç’°å¢ƒã€‚

* åœ¨ç„¡æ³•é€£æ¥ç¶²éš›ç¶²è·¯çš„åœ°å€ï¼Œ**Relay Gateway** å¯ä»¥å°‡ LoRaWAN è¨Šæ¯è½‰ç™¼çµ¦ **Border Gateway**ã€‚
* é€™ç¨® **ä¸­ç¹¼æ©Ÿåˆ¶** ç¢ºä¿äº†å³ä½¿è£ç½®è™•æ–¼ **ç„¡ç¶²è·¯ç’°å¢ƒ**ï¼Œä¹Ÿèƒ½é€é **LoRa é€²è¡Œè³‡æ–™è½‰ç™¼**ï¼Œç›´åˆ°è¨Šæ¯å‚³éè‡³ Border Gateway ä¸¦æœ€çµ‚é€é” **ChirpStack ä¼ºæœå™¨**ã€‚
* **èˆ‡ LoRa è¯ç›Ÿï¼ˆLoRa Allianceï¼‰ çš„ Relay Protocol ä¸åŒ**ï¼Œæ­¤è§£æ±ºæ–¹æ¡ˆ **ä¸éœ€è¦ä¿®æ”¹è£ç½®ç«¯çš„è»Ÿé«”**ï¼Œå› æ­¤æ›´å®¹æ˜“éƒ¨ç½²ã€‚

***

#### **æŠ€è¡“é™åˆ¶**

1. **æ”¯æ´æœ€å¤š 8 å€‹ Hopsï¼ˆè·³é»ï¼‰**
   * ç¬¬ä¸€å€‹ Relay Gateway è¢«è¦–ç‚º **ç¬¬ 1 è·³ï¼ˆHopï¼‰**ã€‚
   * ä¹‹å¾Œæœ€å¤šå¯æœ‰ **7 å€‹é¡å¤–çš„ Relay Gateway**ã€‚
2. **å—é™æ–¼ LoRa ç©ºä¸­æ™‚é–“ï¼ˆAirtimeï¼‰**
   * ç”±æ–¼ Relay Gateway éœ€è¦æ¥æ”¶ä¸¦é‡æ–°å‚³è¼¸å°åŒ…ï¼Œå› æ­¤ç©ºä¸­æ™‚é–“ï¼ˆAirtimeï¼‰ æœƒå½±éŸ¿ä¸­ç¹¼æ•ˆæœã€‚
   * å¦‚æœ Relay éå¤šï¼Œå¯èƒ½æœƒå°è‡´ç¶²è·¯æ“å¡ï¼Œå½±éŸ¿æ•ˆèƒ½ã€‚

***

#### **Relay Gatewayï¼ˆä¸­ç¹¼é–˜é“å™¨ï¼‰ç°¡ä»‹**

Relay Gateway æ˜¯ä¸€ç¨®ç„¡éœ€ç¶²éš›ç¶²è·¯é€£æ¥çš„ LoRaWAN é–˜é“å™¨ï¼Œå¸¸è¦‹ç¡¬é«”ç‚º SX1301/2/3 ç³»åˆ—ï¼ˆå¯é¸é… ISM2400 é›†ä¸­å™¨æ¨¡çµ„ï¼‰ã€‚\
è©²è¨­å‚™å¯ç”±å¤ªé™½èƒ½ä¾›é›»ï¼Œé©åˆéƒ¨ç½²æ–¼åé æˆ–ç„¡é›»åŠ›åŸºç¤è¨­æ–½çš„ç’°å¢ƒä¸­ã€‚

***

#### **Relay Gateway çš„åŠŸèƒ½**

**ä¸Šè¡Œï¼ˆUplinkï¼‰å°åŒ…è™•ç†**

* æ¥æ”¶ä¾†è‡ª LoRaWAN è£ç½®çš„ä¸Šè¡Œè³‡æ–™ã€‚
* å°‡ä¸Šè¡Œè¨Šæ¡†å°è£æˆ Mesh æ ¼å¼ã€‚
* é€é Mesh ç¶²è·¯å°‡å°è£å¾Œçš„è³‡æ–™è½‰ç™¼è‡³å…¶ä»– Relay Gateway æˆ– Border Gatewayã€‚

**ä¸‹è¡Œï¼ˆDownlinkï¼‰å°åŒ…è™•ç†**

* å¾ Border Gateway æˆ–å…¶ä»– Relay Gateway æ¥æ”¶ Mesh æ ¼å¼ä¸‹è¡Œè¨Šæ¡†ã€‚
* è§£å° Mesh å°è£ï¼Œå–å¾—åŸå§‹ LoRaWAN ä¸‹è¡Œè³‡æ–™ã€‚
* å°‡è³‡æ–™å‚³é€è‡³å°æ‡‰çš„ LoRaWAN è£ç½®ã€‚

***

#### **Relay Gateway çš„ç‰¹é»**

* ç„¡éœ€ç¶²éš›ç¶²è·¯é€£ç·šï¼Œé©ç”¨æ–¼é ç«¯æˆ–ç„¡ç¶²è·¯åŸºç¤è¨­æ–½çš„å ´æ™¯ã€‚
* å¯ç”±å¤ªé™½èƒ½ä¾›é›»ï¼Œé©åˆåé åœ°å€é•·æœŸé‹è¡Œã€‚
* é€é ChirpStack Gateway Mesh ç®¡ç†ä¸Šè¡Œèˆ‡ä¸‹è¡Œè³‡æ–™çš„ä¸­ç¹¼å‚³è¼¸ã€‚
* æ”¯æ´å¤šè·³å‚³è¼¸ï¼ˆMulti-Hopï¼‰ï¼Œå¯åœ¨å¤šå€‹ Relay Gateway é–“å‚³éè³‡æ–™ç›´è‡³ Border Gatewayã€‚
* èˆ‡ Border Gateway çš„é€šè¨Šå¯ä½¿ç”¨èˆ‡çµ‚ç«¯è£ç½®ç›¸åŒçš„ç„¡ç·šé »æ®µï¼Œæˆ–æ ¹æ“šç¡¬é«”èƒ½åŠ›èˆ‡æ‡‰ç”¨éœ€æ±‚ä½¿ç”¨ ISM2400 é »æ®µã€‚

***

#### **Relay Gateway çš„çµ„ä»¶éœ€æ±‚**

åœ¨ Relay Gateway ä¸Šéœ€å®‰è£ä»¥ä¸‹çµ„ä»¶ï¼š

* ChirpStack Concentratord
* ChirpStack Gateway Mesh

***

Relay Gateway ä½œç‚º Mesh ç¶²è·¯ä¸­çš„ä¸­ç¹¼ç¯€é»ï¼Œèƒ½æœ‰æ•ˆæ“´å±• LoRaWAN ç¶²è·¯è¦†è“‹ç¯„åœï¼Œå¯¦ç¾ç„¡ç¶²è·¯ç’°å¢ƒä¸‹çš„ç©©å®šé€šè¨Šã€‚

#### **å®‰è£èˆ‡è¨­å®šæŒ‡å—**

***

### **æ­¥é©Ÿ 1ï¼šå®‰è£ ChirpStack LoRaWAN æœå‹™å™¨**

1. ä½¿ç”¨ **SSH** ç™»å…¥æ‚¨çš„ **Hotspot**ã€‚

<figure><img src="../.gitbook/assets/æˆªåœ– 2025-02-12 ä¸Šåˆ8.35.21.png" alt=""><figcaption></figcaption></figure>

2.  ç¾åœ¨é€²å…¥è³‡æ–™å¤¾è·¯å¾‘ï¼š

    {% code overflow="wrap" %}
    ```sh
    # é€²å…¥è³‡æ–™å¤¾è·¯å¾‘
    cd /mnt/opensource-system/chirpstack-docker
    # åˆªé™¤é è¨­çš„ docker-compose.yml æ–‡ä»¶
    rm docker-compose.yml
    # Create the new docker-compose.yml
    vi docker-compose.yml
    ```
    {% endcode %}

ä»¥ä¸‹æ˜¯æ–°çš„ `docker-compose.yml` ç¯„ä¾‹ï¼Œæ‚¨å¯ä»¥ç›´æ¥è¤‡è£½ä¸¦ä½¿ç”¨ **vi ç·¨è¼¯å™¨** è²¼ä¸Šåˆ° **Hotspot** çš„ `docker-compose.yml`ï¼Œç„¶å¾Œå„²å­˜ã€‚

#### æ­¥é©Ÿï¼š

1.  ä½¿ç”¨ **vi ç·¨è¼¯å™¨** é–‹å•Ÿ `docker-compose.yml`ï¼š

    ```sh
    vi docker-compose.yml
    ```
2.  é€²å…¥ **æ’å…¥æ¨¡å¼**ï¼ˆæŒ‰ä¸‹ `i`ï¼‰ï¼Œç„¶å¾Œè²¼ä¸Šä»¥ä¸‹å…§å®¹ï¼š

    ```yaml
    version: "3"

    services:
      chirpstack:
        image: chirpstack/chirpstack:4
        command: -c /etc/chirpstack
        restart: unless-stopped
        volumes:
          - ./configuration/chirpstack:/etc/chirpstack
          - ./lorawan-devices:/opt/lorawan-devices
        depends_on:
          - postgres
          - mosquitto
          - redis
        environment:
          - MQTT_BROKER_HOST=mosquitto
          - REDIS_HOST=redis
          - POSTGRESQL_HOST=postgres
        ports:
          - 8080:8080
        logging:
          driver: "json-file"
          options:
            max-size: "10m"
            max-file: "3"

      chirpstack-rest-api:
        image: chirpstack/chirpstack-rest-api:4
        restart: unless-stopped
        command: --server chirpstack:8080 --bind 0.0.0.0:8090 --insecure
        ports:
          - 8090:8090
        depends_on:
          - chirpstack
        logging:
          driver: "json-file"
          options:
            max-size: "10m"
            max-file: "3"

      postgres:
        image: postgres:14-alpine
        restart: unless-stopped
        volumes:
          - ./configuration/postgresql/initdb:/docker-entrypoint-initdb.d
          - postgresqldata:/var/lib/postgresql/data
        environment:
          - POSTGRES_PASSWORD=root
        logging:
          driver: "json-file"
          options:
            max-size: "10m"
            max-file: "3"

      redis:
        image: redis:7-alpine
        restart: unless-stopped
        command: redis-server --save 300 1 --save 60 100 --appendonly no --ignore-warnings ARM64-COW-BUG
        volumes:
          - redisdata:/data
        logging:
          driver: "json-file"
          options:
            max-size: "10m"
            max-file: "3"

      mosquitto:
        image: eclipse-mosquitto:2
        restart: unless-stopped
        ports:
          - 1883:1883
        volumes: 
          - ./configuration/mosquitto/config/:/mosquitto/config/
        logging:
          driver: "json-file"
          options:
            max-size: "10m"
            max-file: "3"

    volumes:
      postgresqldata:
      redisdata:
    ```
3.  è¨­å®šå–å¾— gateway idï¼š

    {% code overflow="wrap" %}
    ```sh
    cd /etc/linxdot-opensource/chirpstack-border-gateway/chirpstack-concentratord-binary 
    ./chirpstack-concentratord-sx1302 -c config/concentratord.toml -c config/channels_as923.toml | grep gateway_id
    #çœ‹åˆ°gateway_idçš„æ•¸å€¼å¾Œï¼Œå°±å¯ä»¥å…ˆä¸­æ–·
    #åœ¨åŸ·è¡Œlogä¸­æ‰¾åˆ°gateway_id, è¨˜éŒ„ä¸‹ä¾†
    ```
    {% endcode %}
4.  è¨­å®š chirpstack-gateway-mesh-binaryï¼š

    ```sh
    cd /etc/linxdot-opensource/chirpstack-border-gateway/chirpstack-gateway-mesh-binary/config
    rm chirpstack-gateway-mesh.toml
    vi chirpstack-gateway-mesh.toml
    ```
5.  é€²å…¥ **æ’å…¥æ¨¡å¼**ï¼ˆæŒ‰ä¸‹ `i`ï¼‰ï¼Œç„¶å¾Œè²¼ä¸Šä»¥ä¸‹å…§å®¹ï¼š

    ```toml
    # Logging settings.
    [logging]

      # Log level.
      #
      # Valid options are:
      #   * TRACE
      #   * DEBUG
      #   * INFO
      #   * WARN
      #   * ERROR
      #   * OFF
      level="INFO"

      # Log to syslog.
      #
      # When set to true, log messages are being written to syslog instead of stdout.
      log_to_syslog=false


    # Mesh configuration.
    [mesh]

      # Signing key (AES128, HEX encoded).                                           
      #                                                                          
      # This key is used to sign and validate each mesh packet. This key must be
      # configured on every Border / Relay gateway equally.                      
      signing_key="a08ed9e0cca290514071818786f9f9dd" # please change it 

      # Border Gateway.
      #
      # If this is set to true, then the ChirpStack Gateway Mesh will consider
      # this gateway as a Border Gateway, meaning that it will unwrap relayed
      # uplinks and forward these to the proxy API, rather than relaying these.
      border_gateway=false

      # Max hop count.
      #
      # This defines the maximum number of hops a relayed payload will pass.
      max_hop_count=8 # max=8

      # Ignore direct uplinks (Border Gateway).
      #
      # If this is set to true, then direct uplinks (uplinks that are not relay
      # encapsulated) will be silently ignored. This option is especially useful
      # for testing, in which case you want to set this to true for the Border
      # Gateway.
      border_gateway_ignore_direct_uplinks=false

      # Mesh frequencies.
      #
      # The ChirpStack Gateway Mesh will randomly use one of the configured
      # frequencies when relaying uplink and downlink messages.
      frequencies=[                                                                                                                              
        923200000,
        923400000,
        923600000,
        923800000,
        924000000,
        924200000,
        924400000,
        924600000,                                                          
      ]  


      # TX Power (EIRP).
      #
      # The TX Power in EIRP used when relaying uplink and downlink messages.
      tx_power=16

      # Data-rate properties.
      #
      # The data-rate properties when relaying uplink and downlink messages.
      [mesh.data_rate]
      
        # Modulation.
        #
        # Valid options are: LORA, FSK
        modulation="LORA"

        # Spreading-factor (LoRa).
        spreading_factor=7

        # Bandwidth (LoRa).
        bandwidth=125000

        # Code-rate (LoRa).
        code_rate="4/5"

        # Bitrate (FSK).
        bitrate=0


      # Proxy API configuration.
      #
      # If the gateway is configured to operate as Border Gateway. It
      # will unwrap relayed uplink frames, and will wrap downlink payloads that
      # must be relayed. In this case the ChirpStack MQTT Forwarder must be
      # configured to use the proxy API instead of the Concentratord API.
      #
      # Payloads of devices that are under the direct coverage of this gateway
      # are transparently proxied between the ChirpStack MQTT Forwarder and
      # ChirpStack Concentratord.
      #
      # This configuration is only used when the border_gateway option is set
      # to true.
      [mesh.proxy_api]

        # Event PUB socket bind.
        event_bind="ipc:///tmp/gateway_relay_event"

        # Command REP socket bind.
        command_bind="ipc:///tmp/gateway_relay_command"


    # Backend configuration.
    [backend]

      # ChirpStack Concentratord configuration (end-device communication).
      [backend.concentratord]

        # Event API URL.
        event_url="ipc:///tmp/concentratord_event"

        # Command API URL.
        command_url="ipc:///tmp/concentratord_command"


      # ChirpStack Concentratord configuration (mesh communication).
      #
      # While not required, this configuration makes it possible to use a different
      # Concentratord instance for the mesh communication. E.g. this
      # makes it possible to use ISM2400 for mesh communication and EU868 for
      # communication with the end-devices.
      [backend.mesh_concentratord]

        # Event API URL.
        event_url="ipc:///tmp/concentratord_event"

        # Command API URL.
        command_url="ipc:///tmp/concentratord_command"
    ```
6. **å„²å­˜ä¸¦é€€å‡º**ï¼ˆæŒ‰ `ESC`ï¼Œè¼¸å…¥ `:wq`ï¼Œç„¶å¾ŒæŒ‰ `Enter`ï¼‰ã€‚
7.  å•Ÿå‹•æœå‹™ï¼š

    ```sh
     cd /etc/linxdot-opensource
     ./install-chirpstack-border-gateway-concentratord.sh 
     ./install-chirpstack-border-gateway-mesh.sh
    ```
8. åœ¨LoRaWAN Server è¨­å®š Gateway

<figure><img src="../.gitbook/assets/æˆªåœ– 2025-02-21 æ¸…æ™¨7.03.17.png" alt=""><figcaption></figcaption></figure>



#### **Linxdot-ChirpStack Border Gateway Concentratord ç•°å¸¸è™•ç†æŒ‡å—**

è‹¥ **`linxdot-chirpstack-border-gateway-concentratord`** é‹ä½œä¸æ­£å¸¸ï¼Œè«‹æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿè™•ç†ï¼š

***

**Step 1: æš«æ™‚åœæ­¢æœå‹™**

å…ˆé—œé–‰æ­£åœ¨é‹è¡Œçš„æœå‹™ï¼š

```bash
/etc/init.d/linxdot-chirpstack-border-gateway-concentratord stop
```

***

**Step 2: ç§»é™¤èƒŒæ™¯åŸ·è¡Œç¨‹åº**

1.  æŸ¥æ‰¾èƒŒæ™¯åŸ·è¡Œçš„ concentratord ç¨‹å¼ï¼š

    ```bash
    ps | grep concentratord
    ```
2.  æ‰¾åˆ°ç›¸é—œç¨‹åºå¾Œï¼Œä½¿ç”¨ `kill` æŒ‡ä»¤å°‡å…¶åœæ­¢ï¼š

    ```bash
    kill <ç¨‹åºID>
    ```

***

**Step 3: ç¨ç«‹åŸ·è¡Œ Concentratord é€²è¡Œæ¸¬è©¦**

1.  åˆ‡æ›åˆ° concentratord åŸ·è¡Œç›®éŒ„ï¼š

    ```bash
    cd /etc/linxdot-opensource/chirpstack-border-gateway/chirpstack-concentratord-binary
    ```
2.  åŸ·è¡Œæ¸¬è©¦å‘½ä»¤ï¼š

    ```bash
    ./chirpstack-concentratord-sx1302 \
      -c ./config/concentratord.toml \
      -c ./config/region_as923.toml \
      -c ./config/channels_as923.toml
    ```

âœ… **æ­£å¸¸æƒ…æ³**ï¼šçµ‚ç«¯æ©Ÿæœƒé¡¯ç¤ºç›¸é—œåŸ·è¡Œæ—¥èªŒã€‚

***

**Step 4: é‡å•Ÿ Concentratord æœå‹™**

åŸ·è¡Œä»¥ä¸‹å‘½ä»¤é‡æ–°å•Ÿå‹•ä¸¦å•Ÿç”¨é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•ï¼š

```bash
/etc/init.d/linxdot-chirpstack-border-gateway-concentratord enable
/etc/init.d/linxdot-chirpstack-border-gateway-concentratord start
```

***

**Step 5: æŸ¥çœ‹åŸ·è¡Œæ—¥èªŒç¢ºèªç‹€æ…‹**

æŒçºŒæŸ¥çœ‹ concentratord åŸ·è¡Œæ—¥èªŒï¼Œç¢ºèªé‹ä½œæ˜¯å¦æ­£å¸¸ï¼š

```bash
logread -f | grep concentratord
```

***

ğŸ” **å‚™è¨»**ï¼š

* å¦‚é‡åˆ°ç„¡æ³•åœæ­¢çš„èƒŒæ™¯ç¨‹åºï¼Œè«‹ä½¿ç”¨ `kill -9 <ç¨‹åºID>` å¼·åˆ¶çµ‚æ­¢ã€‚
* è‹¥æ—¥èªŒä¸­æœ‰éŒ¯èª¤è¨Šæ¯ï¼Œè«‹è¨˜éŒ„ä¸‹ä¾†ä»¥ä¾¿å¾ŒçºŒæ’æŸ¥æˆ–æä¾›çµ¦æŠ€è¡“æ”¯æ´ã€‚
